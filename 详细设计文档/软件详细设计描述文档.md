# NJUSE影院管理系统<br/>MAMS(Museum Activity Management System)<br/>软件详细设计描述文档

## 文档修改历史

| 修改人员 | 日期     | 修改原因   | 版本号 |
| :------: | -------- | ---------- | ------ |
|   全体   | 2019.5.3 | 写完框架   | V1.0   |
|   全体   | 2019.5.4 | 初步完整版 | V1.1   |
|   全体   | 2019.5.4 | 正式版     | V1.2   |

## 目录
- [1. 引言](#1-引言)
  - [1.1 编制目的](#11-编制目的)
  - [1.2 词汇表](#12-词汇表)
  - [1.3 参考资料](#13-参考资料)

- [2. 产品描述](#2-产品描述)

- [3. 系统结构设计概述](#3-系统结构设计概述)

- [4. 结构视角](#4-结构视角)
  - [4.1 业务逻辑层的分解](#41-业务逻辑层的分解)
    - [4.1.1 userbl模块](#411-userbl模块)
    - [4.1.2 releasebl模块](#412-releasebl模块)
    - [4.1.3 arrangebl模块](#413-arrangebl模块)
    - [4.1.4 moviebl模块](#414-moviebl模块)
    - [4.1.5 marketbl模块](#415-marketbl模块)
    - [4.1.6 ticketbl模块](#416-ticketbl模块)
    - [4.1.7 statisticsrbl模块](#417-statisticsrbl模块)

- [5. 依赖视角](#5-依赖视角)

## 1. 引言

### 1.1 编制目的

本报告详细完成对NJUSE影院管理系统的详细设计，达到指导后续软件构造的目的，同时实现和测试人员及用户的沟通。

本报告面向开发人员、测试人员及最终用户而编写，是了解系统的导航。

### 1.2 词汇表

| 词汇名称 |             词汇含义              | 备注 |      |      |      |
| :------: | :-------------------------------: | :--: | ---- | ---- | ---- |
|   MAMS   | Museum Activity Management System |      |      |      |      |
|   _ui    |            表示_展示层            |      |      |      |      |
|   _bl    |            表示_逻辑层            |      |      |      |      |
|  _data   |            表示_数据层            |      |      |      |      |



### 1.3 参考资料

1.IEEE std 1471-2000
2.《影院管理系统MAMS需求最新版0406》
3.丁二玉，刘钦.计算与软件工程（卷二）[M]机械工业出版社，2012：134~182
4.Frank Buschmann, Regine Meunier, Hans Rohnert, Peter Sommerlad, Micheael Stal.Pattern-Oriented Software Architecture Volume 1: A system of Patterns [M]机械工业出版社,2003

## 2. 产品描述

参考影院管理系统用例文档和影院管理系统软件需求规格说明中对产品的概括描述。影院管理系统MAMS是一个在线影片信息管理系统，旨在提供各种功能来简化售票员、营销人员、总经理、管理员操作流程的网站。既方便了客户快速查询影片信息，又大大提高了影院员工处理普通业务的工作效率，从而全面提高了工作效率和用户的满意程度。

## 3. 系统结构设计概述

参考NJUSE影院体系结构设计文档中对体系结构设计的概述。 

## 4. 结构视角

### 4.1 业务逻辑层的分解

业务逻辑层的开发包图参见软件体系结构文档图

#### 4.1.1 userbl模块

(1) 模块概述

userbl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求。

userbl模块的职责及接口参见软件系统体系结构描述文档。

(2) 整体结构

根据体系结构的设计，我们将系统分为展示层、业务逻辑层、数据层。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加businesslogic.Service.User接口。业务逻辑层和数据层之间添加dataService.DataService接口。。为了隔离业务逻辑职责和逻辑控制职责，我们增加了UserController，这样UserController会将对销售的业务逻辑处理委托给User对象。UserPO是作为持久化对象被添加到设计模型中去的。

**图4-1-1 user模块设计图**

![user模块设计图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-1-1user%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%9B%BE.jpg)

(3) 模块内部类的接口规范

**表4-1-1 UserController的接口规范**

| 提供的服务（供接口）    |          |                                                              |
| ----------------------- | -------- | ------------------------------------------------------------ |
|                         | 语法     | Public UserController login(Stringaccount,String password)   |
| UserController.login    | 前置条件 | 输入的account和password符合语法规范                          |
|                         | 后置条件 | Public UserController register(String account,String newPassword) |
|                         |          |                                                              |
| UserController.register | 语法     | Public UserController register(String account,String newPassword) |
|                         | 前置条件 | 输入符合语法规范                                             |
|                         | 后置条件 | 调用User领域的register方法                                   |
| 需要的服务（需接口）    |          |                                                              |
| User.login              |          | 启动登录回合                                                 |

**表4-1-2 User的接口规范**

| 提供的服务（供接口） |          |                                                      |
| -------------------- | -------- | ---------------------------------------------------- |
|                      | 语法     | Public User login(String account,String password)    |
| User.login           | 前置条件 | 输入的account和password符合语法规范                  |
|                      | 后置条件 | 返回一个找到的User对象                               |
|                      | 语法     | Public User register(String account,String password) |
| User.register        | 前置条件 | 输入的account和password符合语法规范                  |
|                      | 后置条件 | 生成一个持久化的PO对象                               |
| 需要的服务（需接口） |          |                                                      |
| 无                   |          |                                                      |

(4) 业务逻辑层的动态模型

**图4-1-2 登录顺序图**

![登录顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-1-2%E7%99%BB%E5%BD%95%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

**图4-1-3 注册顺序图**

![注册顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-1-3%E6%B3%A8%E5%86%8C%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

(5) 业务逻辑层的设计原理

利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象

#### 4.1.2 releasebl模块

(1) 模块概述

releaserbl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求。 
releasebl模块的职责及接口参见软件系统体系结构描述文档5.3.2

(2) 整体结构

根据体系结构的设计，我们将系统分为展示层、业务逻辑层、数据层。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加blService.Release.ReleaseService接口。业务逻辑层和数据层之间添加DataService.Release.ReleaseDatarService接口。 为了隔离业务逻辑职责和逻辑控制职责，我们增加了 ReleaseController，这样ReleaseController会将对上下架电影、查看已上架影片的业务逻辑处理委托给ReleaseImpl对象。ReleasePO是上架影片的数据格式对象，负责在数据层与逻辑层之间传输数据。ReleasedList是作为上架影片的持久化对象被添加到设计模型中去的的，封装了上架影片列表的数据，持有上架影片的信息的引用。

**图4-2-1 releasebl模块各个类的设计图**

![release模块设计图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-2-1release%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%9B%BE.jpg)

**表4-2-1 releasebl模块各个类的职责表**

| 模块              | 职责                                         |
| :---------------- | :------------------------------------------- |
| ReleaseController | 负责控制ReleaseImpl、ReleaseList实现上架服务 |
| ReleaseImpl       | 实现上、下架电影和查看电影详情服务           |
| ReleasedList      | 持久化记录上架电影清单                       |

(3) 模块内部类的接口规范

ReleaseController、ReleaseImpl、ReleasedList的接口规范如下三表所示

**表4-2-2  ReleaseController的接口规范**

| 提供的服务(供接口)            |          |                                                              |
| ----------------------------- | -------- | ------------------------------------------------------------ |
| ReleaseController.addRelease  | 语法     | public ResultVO addRelease(ReleaseFormVO form)               |
|                               | 前置条件 | 已创建一个ReleaseImpl对象且用户输入电影信息并提交上架请求    |
|                               | 后置条件 | 调用ReleaseImpl的addRelease方法                              |
| ReleaseController.delRelease  | 语法     | public ResultVO addRelease(ReleaseFormVO form)               |
|                               | 前置条件 | 已创建一个ReleaseImpl对象且用户输入电影信息并提交下架电影请求 |
|                               | 后置条件 | 调用ReleaseImpl的delRelease方法                              |
| ReleaseController.viewRelease | 语法     | public List\<ReleaseFormVO\> viewRelease()                   |
|                               | 前置条件 | 已创建一个ReleaseImpl对象且用户输入电影信息并提交上架请求    |
|                               | 后置条件 | 调用ReleaseImpl的viewRelease方法                             |

**需要的服务(需接口)**

| 服务名                                     | 服务             |
| ------------------------------------------ | ---------------- |
| ReleaseImpl.addRelease(ReleaseFormVO form) | 上架相应电影     |
| ReleaseImpl.delRelease(ReleaseFormVO form) | 下架相应电影     |
| ReleaseImpl.viewRelease()                  | 查看上架电影列表 |

**表4-2-3  ReleaseImpl的接口规范**

| 提供的服务(供接口)      |          |                                                |
| ----------------------- | -------- | ---------------------------------------------- |
| ReleaseImpl.addRelease  | 语法     | public ResultVO addRelease(ReleaseFormVO form) |
|                         | 前置条件 | 启动一个上架回合                               |
|                         | 后置条件 | 增加上架电影信息                               |
| ReleaseImpl.delRelease  | 语法     | public ResultVO addRelease(ReleaseFormVO form) |
|                         | 前置条件 | 启动一个下架回合                               |
|                         | 后置条件 | 删除上架电影信息                               |
| ReleaseImpl.viewRelease | 语法     | public List\<ReleaseFormVO\> viewRelease()     |
|                         | 前置条件 | 启动一个修改上架电影信息回合                   |
|                         | 后置条件 | 返回上架电影信息                               |

**需要的服务(需接口)**

| 服务名                                      | 服务                                   |
| ------------------------------------------- | -------------------------------------- |
| ReleasedList.addRelease(ReleaseFormVO form) | 根据对象信息加入相应持久化电影上架信息 |
| ReleasedList.delRelease(ReleaseFormVO form) | 根据对象信息删除相应持久化电影上架信息 |
| ReleasedList.viewRelease()                  | 提供上架电影列表信息                   |

**表4-2-4  ReleasedList的接口规范**

| 提供的服务(供接口)       |          |                                                |
| ------------------------ | -------- | ---------------------------------------------- |
| ReleasedList.addRelease  | 语法     | public ResultVO addRelease(ReleaseFormVO form) |
|                          | 前置条件 | 启动一个上架回合                               |
|                          | 后置条件 | 根据对象信息加入相应持久化电影上架信息         |
| ReleasedList.delRelease  | 语法     | public ResultVO addRelease(ReleaseFormVO form) |
|                          | 前置条件 | 启动一个下架回合                               |
|                          | 后置条件 | 根据对象信息删除相应持久化电影上架信息         |
| ReleasedList.viewRelease | 语法     | public List\<ReleaseFormVO\> viewRelease()     |
|                          | 前置条件 | 启动一个修改上架电影信息回合                   |
|                          | 后置条件 | 返回上架电影信息                               |
| ReleasedList.updateList  | 语法     | public ResultVO updateList(ReleaseFormVO form) |
|                          | 前置条件 | 电影数据中的上架信息已经修改                   |
|                          | 后置条件 | 更新上架电影列表信息                           |

**需要的服务(需接口)**

| 服务名                                                       | 服务                             |
| ------------------------------------------------------------ | -------------------------------- |
| MovieInfoForbl.findByID(long MovieID)                        | 根据id查找并返回是否存在相应电影 |
| MovieInfoForbl.updateRelease(long MovieID，boolean released) | 根据id修改电影数据的上架信息     |

(4) 业务逻辑层的动态模型

下图表明了影院管理系统中，当用户输入了需要上架的电影的详情后，上架电影业务逻辑处理的相关对象之间的协作。

**图4-2-2 上架电影顺序图**

![上架影片顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-2-2%E4%B8%8A%E6%9E%B6%E5%BD%B1%E7%89%87%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

下图表明了影院管理系统中，当用户请求查看已上架电影列表后，上架电影业务逻辑处理的相关对象之间的协作。

**图4-2-3 查看上架电影列表顺序图**

![查看上架电影列表顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-2-3%E6%9F%A5%E7%9C%8B%E5%B7%B2%E4%B8%8A%E6%9E%B6%E5%BD%B1%E7%89%87%E5%88%97%E8%A1%A8%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

下图表明了影院管理系统中，当用户输入了需要下架的电影后，上架电影业务逻辑处理的相关对象之间的协作。

**图4-2-4 下架电影顺序图**

![下架电影顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-2-4%E4%B8%8B%E6%9E%B6%E5%BD%B1%E7%89%87%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)


如下图所示的状态图描述了AddRelease对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着checkMember方法被UI调用，AddRelease进入检验身份状态；通过addRelease进入编辑上架电影状态；通过确认进入编辑进入上架电影列表状态；通过Release进入上架状态最终退出该状态

**图4-2-5 上架电影状态图**
![上架电影状态图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-2-5%E4%B8%8A%E6%9E%B6%E7%94%B5%E5%BD%B1%E7%8A%B6%E6%80%81%E5%9B%BE.jpg)
如下图所示的状态图描述了viewRelease对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着checkMember方法被UI调用，DelRelease进入检验身份状态；通过viewRelease进入查看上架电影状态；通过输入movieID，进入查看指定电影详情状态；最终退出该状态

**图4-2-6 查看上架电影列表状态图**
![查看上架电影列表状态图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-2-6%E6%9F%A5%E7%9C%8B%E4%B8%8A%E6%9E%B6%E7%94%B5%E5%BD%B1%E5%88%97%E8%A1%A8%E7%8A%B6%E6%80%81%E5%9B%BE.jpg)

**图4-2-7 下架电影状态图**
<br>
如下图所示的状态图描述了DelRelease对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着checkMember方法被UI调用，DelRelease进入检验身份状态；通过输入MovieID进入编辑上架电影状态；通过确认进入编辑进入上架电影列表状态；通过Release进入上架状态最终退出该状态
![下架电影状态图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-2-7%E4%B8%8B%E6%9E%B6%E7%94%B5%E5%BD%B1%E7%8A%B6%E6%80%81%E5%9B%BE.jpg)

(5) 业务逻辑层的设计原理

利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象

#### 4.1.3 arrangebl模块

(1) 模块概述

arrangebl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求。 
arrangebl模块的职责及接口参见软件系统体系结构描述文档5.3.2

(2) 整体结构

根据体系结构的设计，我们将系统分为展示层、业务逻辑层、数据层。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加blService.Arrange.ArrangeService接口。业务逻辑层和数据层之间添加DataService.Arrange.ArrangeDatarService接口。 为了隔离业务逻辑职责和逻辑控制职责，我们增加了 ArrangeController，这样ArrangeController会将对排片信息的增删改查和设置、修改排片信息观众可见时间的业务逻辑处理委托给ArrangeImpl对象。ArrangePO是排片信息的数据格式对象，负责在数据层与逻辑层之间传输数据。MovieList是作为电影的排片信息的持久化对象被添加到设计模型中去的的，封装了排片电影列表的数据，持有排片影片的信息的引用。Hall是影厅的持久化对象，封装了各影厅的排片信息数据，持有排片电影的信息的引用。

**图4-3-1 arrangebl模块各个类的设计图**

![arrangebl模块各个类的设计图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-3-1arrange%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%9B%BE.jpg)

**表4-3-1  arrangebl模块的接口规范**

| 模块              | 职责                                         |
| :---------------- | :------------------------------------------- |
| ArrangeController | 负责控制ReleaseImpl、ReleaseList实现上架服务 |
| ArrangeImpl       | 实现上、下架电影和查看电影详情服务           |
| MovieList         | 持久化记录有排片的电影清单                   |
| Hall              | 持久化记录影厅数据                           |

(3) 模块内部类的接口规范

ArrangeController、ArrangeImpl、MovieList、Hall的接口规范如下四表所示

**表4-3-2  ArrangeController的接口规范**

| 提供的服务(供接口)                      |          |                                                              |
| --------------------------------------- | -------- | ------------------------------------------------------------ |
| ArrangeController.addArrangeMovie       | 语法     | public ResultVO addArrange(ArrangeFormVO form)               |
|                                         | 前置条件 | 已创建一个ArrangeImpl对象且用户输入电影信息并提交增加排片请求 |
|                                         | 后置条件 | 调用ArrangeImpl的addArrangeMovie方法                         |
| ArrangeController.updateArrangeMovie    | 语法     | public ResultVO updateArrangeMovie(ArrangeFormVO form)       |
|                                         | 前置条件 | 已创建一个ArrangeImpl对象且用户输入电影信息并提交修改排片信息请求 |
|                                         | 后置条件 | 调用ArrangeImpl的updateArrangeMovie方法                      |
| ArrangeController.delArrangeMovie       | 语法     | public ResultVO delArrangeMovie(ArrangeFormVO form)          |
|                                         | 前置条件 | 已创建一个ArrangeImpl对象且用户输入电影信息并提交删除排片信息请求 |
|                                         | 后置条件 | 调用ArrangeImpl的delArrangeMovie方法                         |
| ArrangeController.viewArrangeMovie      | 语法     | public ArrangeFromVO viewArrangeMovie(long MovieID)          |
|                                         | 前置条件 | 已创建一个ArrangeImpl对象且用户请求查看电影排片信息          |
|                                         | 后置条件 | 调用ArrangeImpl的viewArrangeMovie方法                        |
| ArrangeController.viewAllHall           | 语法     | public List\<HallVO\> viewAllHall()                          |
|                                         | 前置条件 | 已创建一个ArrangeImpl对象且用户请求查看所有影厅排片信息      |
|                                         | 后置条件 | 调用ArrangeImpl的viewAllHall方法                             |
| ArrangeController.viewHall              | 语法     | public HallVO viewHall(long HallID)                          |
|                                         | 前置条件 | 已创建一个ArrangeImpl对象且用户请求查看指定影厅排片信息      |
|                                         | 后置条件 | 调用ArrangeImpl的viewHall方法                                |
| ArrangeController.setArrangeViewtime    | 语法     | public HallVO setArrangeViewtime(ViewtimeFormVO form)        |
|                                         | 前置条件 | 已创建一个ArrangeImpl对象且用户输入排片信息观众可见时间并提交请求 |
|                                         | 后置条件 | 调用ArrangeImpl的setArrangeViewtime方法                      |
| ArrangeController.updateArrangeViewtime | 语法     | public HallVO updateArrangeViewtime(ViewtimeFormVO form)     |
|                                         | 前置条件 | 已创建一个ArrangeImpl对象且用户输入排片信息观众可见时间并提交请求 |
|                                         | 后置条件 | 调用ArrangeImpl的updateArrangeViewtime方法                   |

**需要的服务(需接口)**

| 服务名                                                 | 服务                       |
| ------------------------------------------------------ | -------------------------- |
| ArrangeImpl.addArrangeMovie(ArrangeFormVO form)        | 增加排片信息               |
| ArrangeImpl.delArrangeMovie(ArrangeFormVO form)        | 删除排片信息               |
| ArrangeImpl.updateArrangeMovie(ArrangeFormVO form)     | 修改排片信息               |
| ArrangeImpl.viewArrangeMovie(long MovieID)             | 根据ID查看相应电影排片信息 |
| ArrangeImpl.viewAllHall()                              | 查看所有影厅的排片信息     |
| ArrangeImpl.viewHall(long HallID)                      | 根据ID查看相应影厅排片信息 |
| ArrangeImpl.setArrangeViewtime(ViewtimeFormVO form)    | 设置排片信息观众可见时间   |
| ArrangeImpl.updateArrangeViewtime(ViewtimeFormVO form) | 修改排片信息观众可见时间   |

**表4-3-3  ArrangeImpl的接口规范**

| 提供的服务(供接口)                |          |                                                          |
| --------------------------------- | -------- | -------------------------------------------------------- |
| ArrangeImpl.addArrangeMovie       | 语法     | public ResultVO addArrange(ArrangeFormVO form)           |
|                                   | 前置条件 | 启动一个增加排片回合                                     |
|                                   | 后置条件 | 增加影片、影厅的排片信息                                 |
| ArrangeImpl.updateArrangeMovie    | 语法     | public ResultVO updateArrangeMovie(ArrangeFormVO form)   |
|                                   | 前置条件 | 启动一个修改排片信息回合                                 |
|                                   | 后置条件 | 修改影片、影厅的排片信息                                 |
| ArrangeImpl.delArrangeMovie       | 语法     | public ResultVO delArrangeMovie(ArrangeFormVO form)      |
|                                   | 前置条件 | 启动一个删除排片回合                                     |
|                                   | 后置条件 | 删除影片、影厅的排片信息                                 |
| ArrangeImpl.viewArrangeMovie      | 语法     | public ArrangeFromVO viewArrangeMovie(long MovieID)      |
|                                   | 前置条件 | 启动一个查看影片排片信息回合                             |
|                                   | 后置条件 | 返回影片的排片信息                                       |
| ArrangeImpl.viewAllHall           | 语法     | public List\<HallVO\> viewAllHall()                      |
|                                   | 前置条件 | 启动一个查看所有影厅排片回合                             |
|                                   | 后置条件 | 返回所有影厅的排片信息                                   |
| ArrangeImpl.viewHall              | 语法     | public HallVO viewHall(long HallID)                      |
|                                   | 前置条件 | 启动一个查看指定影厅排片回合                             |
|                                   | 后置条件 | 返回指定影厅的排片信息                                   |
| ArrangeImpl.setArrangeViewtime    | 语法     | public HallVO setArrangeViewtime(ViewtimeFormVO form)    |
|                                   | 前置条件 | 启动一个设置排片信息观众可见时间回合                     |
|                                   | 后置条件 | 设置电影排片信息观众可见时间数据                         |
| ArrangeImpl.updateArrangeViewtime | 语法     | public HallVO updateArrangeViewtime(ViewtimeFormVO form) |
|                                   | 前置条件 | 启动一个修改排片信息观众可见时间回合                     |
|                                   | 后置条件 | 修改电影排片信息观众可见时间数据                         |

**需要的服务(需接口)**

| 服务名                                                   | 服务                                         |
| -------------------------------------------------------- | -------------------------------------------- |
| MovieList.addArrange(ArrangeFormVO form)                 | 在有排片的电影中增加排片信息数据             |
| MovieList.delArrange(ArrangeFormVO form)                 | 在有排片的电影中删除排片信息数据             |
| MovieList.updateArrange(ArrangeFormVO form)              | 在有排片的电影中修改排片信息数据             |
| MovieList.find(long MovieID)                             | 根据ID查找该电影是否有排片                   |
| ArrangeMoviePO.updateArrange(ArrangeFormVO form)         | 根据用户的输入修改电影的排片信息             |
| ArrangeMoviePO.updateArrangeViewtime(ArrangeFormVO form) | 根据用户的输入修改电影的排片信息观众可见时间 |
| ArrangeMoviePO.setArrangeViewtime(ArrangeFormVO form)    | 根据用户的输入设置电影的排片信息观众可见时间 |
| ArrangeMoviePO.viewArrange(long MovieID)                 | 根据ID查找并返回相应电影的排片信息           |
| Hall.getMovies()                                         | 返回该影厅所有排片信息                       |

**表4-3-4  MovieList的接口规范**

| 提供的服务(供接口)      |          |                                                   |
| ----------------------- | -------- | ------------------------------------------------- |
| MovieList.addArrange    | 语法     | public ResultVO addArrange(ArrangeFormVO form)    |
|                         | 前置条件 | 启动一个增加排片回合                              |
|                         | 后置条件 | 根据对象信息在排片列表加入相应持久化电影排片信息  |
| MovieList.updateArrange | 语法     | public ResultVO updateArrange(ArrangeFormVO form) |
|                         | 前置条件 | 启动一个修改排片信息回合                          |
|                         | 后置条件 | 根据对象信息在排片列表修改相应持久化电影排片信息  |
| MovieList.delArrange    | 语法     | public ResultVO delArrange(ArrangeFormVO form)    |
|                         | 前置条件 | 启动一个删除排片回合                              |
|                         | 后置条件 | 根据对象信息在排片列表删除相应持久化电影排片信息  |
| MovieList.find          | 语法     | public ResultVO find(long MovieID)                |
|                         | 前置条件 | 无                                                |
|                         | 后置条件 | 返回找列表中查找相应电影的结果                    |

**需要的服务(需接口)**

| 服务名                                | 服务                                     |
| ------------------------------------- | ---------------------------------------- |
| MovieInfoForbl.findByID(long MovieID) | 根据id查找并返回相应电影是否存在排片信息 |

**表4-3-5  Hall的接口规范**

| 提供的服务(供接口)      |          |                                                        |
| ----------------------- | -------- | ------------------------------------------------------ |
| Hall.addArrangeMovie    | 语法     | public ResultVO addArrangeMovie(ArrangeFormVO form)    |
|                         | 前置条件 | 排片电影列表已添加排片信息                             |
|                         | 后置条件 | 根据对象信息在影厅中加入相应持久化电影排片信息         |
| Hall.updateArrangeMovie | 语法     | public ResultVO updateArrangeMovie(ArrangeFormVO form) |
|                         | 前置条件 | 无                                                     |
|                         | 后置条件 | 根据对象信息在影厅中修改相应持久化电影排片信息         |
| Hall.delArrangeMovie    | 语法     | public ResultVO delArrangeMovie(ArrangeFormVO form)    |
|                         | 前置条件 | 排片电影列表已删除排片信息                             |
|                         | 后置条件 | 根据对象信息在影厅中删除相应持久化电影排片信息         |
| Hall.getMovies          | 语法     | public List\<Long\> getMovies()                        |
|                         | 前置条件 | 无                                                     |
|                         | 后置条件 | 返回影厅中所有有排片的电影id列表                       |

**需要的服务(需接口)**

| 服务名                                | 服务                                     |
| ------------------------------------- | ---------------------------------------- |
| MovieInfoForbl.findByID(long MovieID) | 根据id查找并返回相应电影是否存在排片信息 |

(4) 业务逻辑层的动态模型

下图表明了影院管理系统中，当用户输入了需要添加的排片信息后，排片业务逻辑处理的相关对象之间的协作。

**图4-3-2 添加排片信息顺序图**

![添加排片信息顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-3-2%E6%B7%BB%E5%8A%A0%E6%8E%92%E7%89%87%E4%BF%A1%E6%81%AF%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

下图表明了影院管理系统中，当用户输入了需要修改的排片信息后，排片业务逻辑处理的相关对象之间的协作。

**图4-3-3 修改排片信息顺序图**

![修改排片信息顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-3-3%E4%BF%AE%E6%94%B9%E6%8E%92%E7%89%87%E4%BF%A1%E6%81%AF%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

下图表明了影院管理系统中，当用户输入了需要删除的排片信息后，排片业务逻辑处理的相关对象之间的协作。

**图4-3-4 删除排片信息顺序图**

![删除排片信息顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-3-4%E5%88%A0%E9%99%A4%E6%8E%92%E7%89%87%E4%BF%A1%E6%81%AF%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

下图表明了影院管理系统中，当用户输入了需要查看的电影的排片信息后，排片业务逻辑处理的相关对象之间的协作。

**图4-3-5 查看排片信息影片视角顺序图**

![查看排片信息影片视角顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-3-5%E6%9F%A5%E7%9C%8B%E6%8E%92%E7%89%87%E4%BF%A1%E6%81%AF%E5%BD%B1%E7%89%87%E8%A7%86%E8%A7%92%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

下图表明了影院管理系统中，当用户输入了需要查看的影厅的排片信息后，排片业务逻辑处理的相关对象之间的协作。

**图4-3-6 查看排片信息单影厅视角顺序图**

![查看排片信息单影厅视角顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-3-6%E6%9F%A5%E7%9C%8B%E6%8E%92%E7%89%87%E4%BF%A1%E6%81%AF%E5%8D%95%E5%BD%B1%E5%8E%85%E8%A7%86%E8%A7%92%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

下图表明了影院管理系统中，当用户请求查看所有影厅的排片信息后，排片业务逻辑处理的相关对象之间的协作。

**图4-3-7 查看排片信息全影厅视角顺序图**

![查看排片信息全影厅视角顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-3-7%E6%9F%A5%E7%9C%8B%E6%8E%92%E7%89%87%E4%BF%A1%E6%81%AF%E5%85%A8%E5%BD%B1%E5%8E%85%E8%A7%86%E8%A7%92%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

下图表明了影院管理系统中，当用户输入了需要设置的排片信息观众可见时间后，排片业务逻辑处理的相关对象之间的协作。

**图4-3-8 设置排片信息观众可见时间顺序图**

![设置排片信息观众可见时间顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-3-8%E8%AE%BE%E7%BD%AE%E6%8E%92%E7%89%87%E4%BF%A1%E6%81%AF%E8%A7%82%E4%BC%97%E5%8F%AF%E8%A7%81%E6%97%B6%E9%97%B4%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

下图表明了影院管理系统中，当用户输入了需要修改的排片信息观众可见时间后，排片业务逻辑处理的相关对象之间的协作。

**图4-3-9 修改排片信息观众可见时间顺序图**

![修改排片信息观众可见时间顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-3-9%E4%BF%AE%E6%94%B9%E6%8E%92%E7%89%87%E4%BF%A1%E6%81%AF%E8%A7%82%E4%BC%97%E5%8F%AF%E8%A7%81%E6%97%B6%E9%97%B4%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

如下图所示的状态图描述了AddArrangeMovie对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着checkMember方法被UI调用，endAddArrangeMovie进入检验身份状态；通过endAddArrangeMovie进入形成上架电影列表状态；通过输入movieID,编辑进入电影详情状态；最终退出该状态**图4-3-10 添加排片信息状态图**

![添加排片信息状态图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-3-10%E6%B7%BB%E5%8A%A0%E6%8E%92%E7%89%87%E4%BF%A1%E6%81%AF%E5%AF%B9%E8%B1%A1%E7%8A%B6%E6%80%81%E5%9B%BE.jpg)如下图所示的状态图描述了UpdateArrangeMovie对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着checkMember方法被UI调用，AddArrangeMovie进入检验身份状态；通过updateArrangeMovie进入查看上架电影列表状态；通过输入movieID,进入编辑电影排片信息状态,并更新上架电影排片信息；最终退出该状态

**图4-3-11 修改排片信息状态图**
![修改排片信息状态图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-3-11%E4%BF%AE%E6%94%B9%E6%8E%92%E7%89%87%E4%BF%A1%E6%81%AF%E7%8A%B6%E6%80%81%E5%9B%BE.jpg)

(5) 业务逻辑层的设计原理

利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象

#### 4.1.4 moviebl模块

(1) 模块概述

moviebl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求。 
moviebl模块的职责及接口参见软件系统体系结构描述文档5.3.2

(2) 整体结构

根据体系结构的设计，我们将系统分为展示层、业务逻辑层、数据层。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加blService.Movie.MovieService接口。业务逻辑层和数据层之间添加DataService.Movie.MovieDatarService接口。 为了隔离业务逻辑职责和逻辑控制职责，我们增加了 MovieController，这样MovieController会将对查看、修改电影详情和搜索电影的业务逻辑处理委托给MovieImpl对象。MoviePO是电影的数据格式对象，负责在数据层与逻辑层之间传输数据。MovieInfoForbl是作为电影的数据接口被添加到设计模型中去的的，是逻辑层其他模块依赖的接口。

**图4-4-1 moviebl模块各个类的设计图**

![moviebl模块各个类的设计图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-4-1movie%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%9B%BE.jpg)

**表4-4-1 moviebl模块各个类的职责**

| 模块                  | 职责                                               |
| :-------------------- | :------------------------------------------------- |
| MovieController       | 负责控制电影界面服务的实现                         |
| MovieImpl             | 负责实现搜索电影、查看电影详情、修改电影信息的服务 |
| ArrangeMovieInfoForbl | 提供逻辑层其他模块依赖的接口                       |

(3) 模块内部类的接口规范

MovieController、MovieImpl、MovieInfoForbl的接口规范如下三表所示

**表4-4-2  MovieController的接口规范**

| 提供的服务(供接口)              |          |                                                        |
| ------------------------------- | -------- | ------------------------------------------------------ |
| MovieController.updateMovieInfo | 语法     | public ResultVO updateMovieInfo(MovieFormVO form)      |
|                                 | 前置条件 | 用户输入需要修改的电影信息并提交请求                   |
|                                 | 后置条件 | 调用MovieImpl的updateMovieInfo方法                     |
| MovieController.viewMovieInfo   | 语法     | public MovieFormVO viewMovieInfo(long MovieID)         |
|                                 | 前置条件 | 用户请求查看指定电影详情                               |
|                                 | 后置条件 | 调用MovieImpl的viewMovieInfo方法                       |
| MovieController.searchMovie     | 语法     | public List\<MovieFormVO\> searchMovie(String keyword) |
|                                 | 前置条件 | 用户输入需要查找的电影关键词并提交请求                 |
|                                 | 后置条件 | 调用MovieImpl的searchMovie方法                         |

**需要的服务(需接口)**

| 服务名                                      | 服务                             |
| ------------------------------------------- | -------------------------------- |
| MovieImpl.updateMovieInfo(MovieFormVO form) | 根据输入的信息修改相应电影的信息 |
| MovieImpl.viewMovieInfo(long MovieID)       | 根据ID返回相应电影的详细信息     |
| MovieImpl.searchMovie(String keyword)       | 根据关键词返回匹配的电影列表     |

**表4-4-3  MovieImpl的接口规范**

| 提供的服务(供接口)        |          |                                                        |
| ------------------------- | -------- | ------------------------------------------------------ |
| MovieImpl.updateMovieInfo | 语法     | public ResultVO updateMovieInfo(MovieFormVO form)      |
|                           | 前置条件 | 启动一个修改电影信息回合                               |
|                           | 后置条件 | 根据输入的数据修改电影数据                             |
| MovieImpl.viewMovieInfo   | 语法     | public MovieFormVO viewMovieInfo(long MovieID)         |
|                           | 前置条件 | 启动一个查看电影详情回合                               |
|                           | 后置条件 | 返回搜索结果                                           |
| MovieImpl.searchMovie     | 语法     | public List\<MovieFormVO\> searchMovie(String keyword) |
|                           | 前置条件 | 用户输入需要查找的电影关键词并提交请求                 |
|                           | 后置条件 | 根据关键词返回匹配的电影列表                           |

**需要的服务(需接口)**

| 服务名                                        | 服务                                       |
| --------------------------------------------- | ------------------------------------------ |
| MoviePO.updateMovieInfo(MovieFormVO form)     | 根据输入的信息修改相应电影的信息           |
| MovieDataservice.getMovieInfo(long MovieID)   | 根据ID返回相应电影的详细信息               |
| MovieDataService.viewMovieInfo(MoviePO movie) | 根据关键词构建的电影信息返回匹配的电影列表 |

**表4-4-4  MovieInfoForbl的接口规范**

| 提供的服务(供接口)             |          |                                                              |
| ------------------------------ | -------- | ------------------------------------------------------------ |
| ArrangeMovieInfo.findByID      | 语法     | public ResultVO findByID(long MovieID)                       |
|                                | 前置条件 | 用户请求查看指定电影是否有排片                               |
|                                | 后置条件 | 返回指定电影是否有排片的结果                                 |
| ArrangeMovieInfo.updateRelease | 语法     | public ResultVO updateRelease(long MovieID，boolean released) |
|                                | 前置条件 | 启动一个上架电影回合                                         |
|                                | 后置条件 | 返回信息更新结果                                             |

**需要的服务(需接口)**

| 服务名                                        | 服务                                       |
| --------------------------------------------- | ------------------------------------------ |
| MoviePO.updateMovieInfo(MovieFormVO form)     | 根据输入的信息修改相应电影的信息           |
| MovieDataservice.getMovieInfo(long MovieID)   | 根据ID返回相应电影的详细信息               |
| MovieDataService.viewMovieInfo(MoviePO movie) | 根据关键词构建的电影信息返回匹配的电影列表 |

(4) 业务逻辑层的动态模型

下图表明了影院管理系统中，当用户输入了需要搜索的电影的关键词后，电影业务逻辑处理的相关对象之间的协作。

**图4-4-2 搜索电影顺序图**

![搜索电影顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-4-2%E6%90%9C%E7%B4%A2%E7%94%B5%E5%BD%B1%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

下图表明了影院管理系统中，当用户输入了需要修改的电影详情信息后，电影业务逻辑处理的相关对象之间的协作。

**图4-4-3 修改电影信息顺序图**

![修改电影信息顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-4-3%E4%BF%AE%E6%94%B9%E7%94%B5%E5%BD%B1%E4%BF%A1%E6%81%AF%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

下图表明了影院管理系统中，当用户输入了需要查看的电影详情后，电影业务逻辑处理的相关对象之间的协作。

**图4-4-4 查看电影详情顺序图**

![查看电影详情顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-4-4%E6%9F%A5%E7%9C%8B%E7%94%B5%E5%BD%B1%E8%AF%A6%E6%83%85%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

如下图所示的状态图描述了search对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着checkMember方法被UI调用，Search进入检验身份状态；通过inputMovie,进入查看电影列表状态，输入MovieID进入查看电影详情状态，最终退出该状态。

**图4-4-5 电影对象查询状态图**

![电影对象查询状态图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-4-5%E7%94%B5%E5%BD%B1%E5%AF%B9%E8%B1%A1%E6%9F%A5%E8%AF%A2%E7%8A%B6%E6%80%81%E5%9B%BE.jpg)

(5) 业务逻辑层的设计原理

利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象

#### 4.1.5 marketbl模块

(1) 模块概述

marketbl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求。

marketbl模块的职责及接口参见软件系统体系结构描述文档。

(2) 整体结构

根据体系结构的设计，我们将系统分为展示层、业务逻辑层、数据层。每一层之间为了
增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加businesslogic.promotion接口。业务逻辑层和数据层之间添加dataService.VIPcard接口。为了隔离业务逻辑职责和逻辑控制职责，我们增加了marketController

**图4-5-1 marketbl模块各个类的设计图**

![marketbl模块各个类的设计图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-5-1market%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%9B%BE.jpg)

(3) 模块内部类的接口规范

**表4-5-1 marketbl模块的接口规范表**

| 提供的服务（供接口）    |          |                                                |
| ----------------------- | -------- | ---------------------------------------------- |
|                         | 语法     | Public VIPcard purchaseFeedBack()              |
| VIPcard.purchaseFeedack | 前置条件 | 用户发起购买请求                               |
|                         | 后置条件 | 返回VIPcard购买界面                            |
|                         | 语法     | Public VIPcard charge(long cardID,long money)  |
| VIPcard.charge          | 前置条件 | 用户发起充值请求                               |
|                         | 后置条件 | 返回会员卡信息                                 |
|                         | 语法     | Public promotion(String condition)             |
| Promotion.promotion     | 前置条件 | 用户传入优惠信息                               |
|                         | 后置条件 | Pay获得promotion信息                           |
|                         | 语法     | Public VIPcard viewinfo(long cardID)           |
| VIPcard.view            | 前置条件 | 用户发起查看请求                               |
|                         | 后置条件 | 返回会员卡信息                                 |
| 需要的服务（需接口）    |          |                                                |
| VIPcard.purchaseRequest |          | 用户发出购买请求                               |
| VIPcard.request         |          | 用户确认充值信息后发出支付请求                 |
| VIPcard.addVIPcard      |          | 添加一个持久化VIP对象                          |
| VIPcard.selectCharge    |          | 用户选择充值类型                               |
| VIPcard.charge          |          | 用户输入充值信息                               |
| VIPcard.chargeACK       |          | 用户确认充值信息后发出支付请求                 |
| Pay.pay                 |          | 用户支付钱款                                   |
| User.VIPview            |          | 用户发起查看余额请求                           |
| DataBase.info           |          | DataBase返回VIPcard的余额信息                  |
| DataBase.addmoney       |          | DataBase中相应VIPcard的余额增加                |
| User.PromotionRequest   |          | 用户提出发起优惠活动请求                       |
| User.Promotioninfo      |          | 用户输入优惠活动的起止时间、具体优惠事项等信息 |
| PromotionPO.promotionpo |          | 创建一个持续化promotion对象                    |
| Promotion.modifyPay     |          | 在结算时使用优惠信息结算                       |

(4) 业务逻辑层的动态模型

**图4-5-2 查看会员卡顺序图**

![查看会员卡顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-5-2%E6%9F%A5%E7%9C%8B%E4%BC%9A%E5%91%98%E5%8D%A1%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

**图4-5-3 充值会员卡顺序图**

![充值会员卡顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-5-3%E5%85%85%E5%80%BC%E4%BC%9A%E5%91%98%E5%8D%A1%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

**图4-5-4 购买会员卡顺序图**

![购买会员卡顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-5-4%E8%B4%AD%E4%B9%B0%E4%BC%9A%E5%91%98%E5%8D%A1%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

**图4-5-5 发布优惠活动顺序图**

![发布优惠活动顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-5-5%E5%8F%91%E5%B8%83%E4%BC%98%E6%83%A0%E6%B4%BB%E5%8A%A8%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

如下图所示的状态图描述了CheckVIP对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着checkMember方法被UI调用，ChargeVIP进入检验身份状态；通过或VIPview进入准备充值状态；通过charge,进入充值状态，最终退出该状态

**图4-5-6 查看会员卡对象状态图**

![查看会员卡对象状态图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-5-6%E6%9F%A5%E7%9C%8B%E4%BC%9A%E5%91%98%E5%8D%A1%E5%AF%B9%E8%B1%A1%E7%8A%B6%E6%80%81%E5%9B%BE.jpg)

如下图所示的状态图描述了ChargeVIP对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着checkMember方法被UI调用，ChargeVIP进入检验身份状态；通过selectCharge或charge或chargeACK进入准备充值状态；通过charge,进入充值状态，最终退出该状态

**图4-5-7 充值会员卡对象状态图**

![充值会员卡对象状态图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-5-7%E5%85%85%E5%80%BC%E4%BC%9A%E5%91%98%E5%8D%A1%E5%AF%B9%E8%B1%A1%E7%8A%B6%E6%80%81%E5%9B%BE.jpg)

如下图所示的状态图描述了PurchaseVIP对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着checkMember方法被UI调用，PurchaseRequest进入检验身份状态；通过request进入获得price状态；充值状态；通过purchase，进入购买状态，最终退出该状态

**图4-5-8 购买会员卡对象状态图**

![购买会员卡对象状态图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-5-8%E8%B4%AD%E4%B9%B0%E4%BC%9A%E5%91%98%E5%AF%B9%E8%B1%A1%E7%8A%B6%E6%80%81%E5%9B%BE.jpg)

如下图所示的状态图描述了Promption对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着addPromotion方法被UI调用，Promotion进入更新促销列表状态；通过fresh刷新影片价格,通过total，进入支付状态，最终退出该状态。

**图4-5-9 发布促销活动对象状态图**

![发布促销活动对象状态图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-5-9%E5%8F%91%E5%B8%83%E4%BF%83%E9%94%80%E6%B4%BB%E5%8A%A8%E5%AF%B9%E8%B1%A1%E7%8A%B6%E6%80%81%E5%9B%BE.jpg)

(5) 业务逻辑层的设计原理

利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象

#### 4.1.6 ticketbl模块

(1) 模块概述

ticketbl模块承担的需求见需求规格说明书文档功能需求及相关非功能需求。

ticketbl模块的职责及接口参见软件体系结构描述文档表。

(2) 整体结构

根据体系结构的设计，采用分层风格，将系统分为展示层，业务逻辑层，数据层。每一层之间为了灵活性，添加了接口，以实现针对接口编程，隔离数据传输的职责，降低层与层之间耦合，添加了ticketblservice, ticketdataservice两个接口。为了隔离业务逻辑职责和逻辑控制职责，我们添加了ticketController，这样ticketController将会将发布整体框架策略的业务逻辑职责和逻辑控制委托给ticketbl对象。ticketPO是做为框架信息的持久化对象被添加到设计模型中的，而TicketList封装了Ticket数据集合的数据结构和组织形式。

**图4-6-1 ticketbl模块各个类的设计**

![ticket模块设计图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-6-1ticket%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%9B%BE.jpg)

 **表4-6-1 ticketbl模块各个类的职责**

|       模块       |                             职责                             |
| :--------------: | :----------------------------------------------------------: |
| TicketController |                 负责实现影票界面所需要的服务                 |
|      Ticket      |    影票的领域模型对象，拥有影票数据的价格和已购票用户的ID    |
|    TicketList    | 保有某用户或电影的影票信息的数据，及相应的计算统计数据的职责 |

(3) 模块内部类的接口规范

**表4-6-2  TicketController的接口规范**

|       提供的接口（供接口）       |          |                                                              |
| :------------------------------: | :------: | ------------------------------------------------------------ |
|    TicketController.addTicket    |   语法   | public ResultMessage addTicket(long userID, long movieID, int quantity, double discount) |
|                                  | 前置条件 | 启动一个购买回合                                             |
|                                  | 后置条件 | 调用Ticket领域对象的addTicket方法                            |
| TicketController.getTicketByUser |   语法   | public ResultVO getTicketByUser(long userID)                 |
|                                  | 前置条件 | 请求一个查看已购电影票回合，且输入符合输入规则               |
|                                  | 后置条件 | 调用Ticket领域对象的getTicketByUser方法                      |

|                     需要的服务（需接口）                     |                          |
| :----------------------------------------------------------: | ------------------------ |
|                            服务名                            | 服务                     |
|             Ticket.getTicketByUser(long userID)              | 查看用户已购的电影票信息 |
| Ticket.addTicket(long uesrID, long movieID, int quantity, double discount) | 购买电影票               |

**表4-6-3 为Ticket的接口规范**

|  提供的接口（供接口）  |          |                                                              |
| :--------------------: | :------: | ------------------------------------------------------------ |
|    Ticket.addTicket    |   语法   | public ResultMessage addTicket(long userID, long movieID, int quantity, double discount) |
|                        | 前置条件 | 已创建一个Ticket对象                                         |
|                        | 后置条件 | 在一个购买回合中，增加用户购买的电影票信息和数量并根据discount扣除相应款项 |
| Ticket.getTicketByUser |   语法   | public ResultVO getTicketByUser(long userID)                 |
|                        | 前置条件 | 已创建一个Ticket领域对象，且输入符合输入规则                 |
|                        | 后置条件 | 返回用户的购买信息                                           |

|                     需要的服务（需接口）                     |                          |
| :----------------------------------------------------------: | ------------------------ |
|                            服务名                            | 服务                     |
|         TicketList.update(long userID, long movieID)         | 插入单一持久化对象       |
|           TicketList.getTicketByUser(long userID)            | 查看用户已购的电影票信息 |
| TicketList.addTicket(long uesrID, long movieID, int quantity, double discount) | 购买电影票               |

**表4-6-4 为TicketList的接口规范**

|    提供的接口（供接口）    |          |                                                              |
| :------------------------: | :------: | ------------------------------------------------------------ |
|     TicketList.update      |   语法   | public ResultMessage update(long userID, long movieID)       |
|                            | 前置条件 | Ticket领域对象调用TicketList的update方法                     |
|                            | 后置条件 | 无                                                           |
| TicketList.getTicketByUser |   语法   | public ResultVO TicketList.getTicketByUser(long userID)      |
|                            | 前置条件 | Ticket领域对象调用TicketList的getTicketByUser方法            |
|                            | 后置条件 | 无                                                           |
|    TicketList.addTicket    |   语法   | public ResultMessage addTicket(long uesrID, long movieID, int quantity, double discount) |
|                            | 前置条件 | Ticket领域对象调用TicketList的addTicket方法                  |
|                            | 后置条件 | 更新Ticket数据中的影票和用户信息                             |

(4) 业务逻辑层的动态模型

**图4-6-2 Ticket对象想要查看已购电影票的顺序图**

![用户查看已购电影票顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-6-2%E7%94%A8%E6%88%B7%E6%9F%A5%E7%9C%8B%E5%B7%B2%E8%B4%AD%E7%94%B5%E5%BD%B1%E7%A5%A8%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

**图4-6-3 Ticket对象想要购买电影票的顺序图**

![购买电影票顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-6-3%E8%B4%AD%E4%B9%B0%E7%94%B5%E5%BD%B1%E7%A5%A8%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)



如下图所示的状态图描述了getMyTicket对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着checkMember方法被UI调用，addTicket进入检验身份状态；通过getTicket,进入查看我的影票列表状态，删ticket，进入更新Ticktetlist状态，最终退出该状态

**图4-6-4 Ticket对象查看已购电影票的状态图**

![查看已购电影票状态图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-6-4%E6%9F%A5%E7%9C%8B%E5%B7%B2%E8%B4%AD%E7%94%B5%E5%BD%B1%E7%A5%A8%E7%8A%B6%E6%80%81%E5%9B%BE.jpg)

如下图所示的状态图描述了Ticket对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着checkMember方法被UI调用，addTicket进入检验身份状态；通过total进入支付状态；增删调改ticket进入更新Ticktetlist状态，最终退出该状态

**图4-6-5 购买电影票的状态图**

![购买电影票状态图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-6-5%E8%B4%AD%E4%B9%B0%E7%94%B5%E5%BD%B1%E7%A5%A8%E7%8A%B6%E6%80%81%E5%9B%BE.jpg)

(5) 业务逻辑层的设计原理

利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象。

#### 4.1.7 statisticsrbl模块

(1) 模块概述

statisticsbl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求

statisticsbl模块的职责及接口参见软件系统体系结构描述文档

(2) 整体结构

根据体系结构的设计，我们将系统分为展示层、业务逻辑层、数据层。每一层之间为了
增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加businesslogic.User接口。业务逻辑层和数据层之间添加dataService.movie接口。。为了隔离业务逻辑职责和逻辑控制职责，我们增加了statisticsController，这样statisticsController会将对查询的业务逻辑处理委托给statistics对象。statisticsPO是作为快递记录的持久化对象被添加到设计模型中去的。

**图4-7-1 statisticsbl模块各个类的设计图**

![statistics模块设计图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-7-1statistics%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%9B%BE.jpg)

(3) 模块内部类的接口规范

**表4-7-1 statisticsbl模块的接口规范**

| 提供的服务（供接口）   |          |                                             |
| ---------------------- | -------- | ------------------------------------------- |
|                        | 语法     | Public Statistic select()                   |
| Statistics.select      | 前置条件 | 用户发起查询请求                            |
|                        | 后置条件 | 返回一个想查看信息页面                      |
|                        | 语法     | Public Statistic printsta(String staWanted) |
| Statistics.printsta    | 前置条件 | 用户已选择想查看的信息并提交                |
|                        | 后置条件 | 展示相应的信息页面                          |
|                        | 语法     | Public Statistic countAll()                 |
| Statistics.count       | 前置条件 | 用户发起查询请求                            |
|                        | 后置条件 | 返回包含所有电影统计信息的页面              |
|                        | 语法     | Public Statistic printSelect(long movieID)  |
| Statistics.printSelect | 前置条件 | 用户选择一部特定的影片                      |
|                        | 后置条件 | 返回该影片的想看人数                        |
|                        | 语法     | Public boolean mark(long movieID)           |
| Statistic.mark         | 前置条件 | 用户发起标记请求                            |
|                        | 后置条件 | 电影的标记状态与发起请求前不一样            |
| 需要的服务（需接口）   |          |                                             |
| User.viewRequest       |          | 用户发起查看统计数据请求                    |
| User.viewAll           |          | 用户发起查看想看人数的请求                  |
| User.mark              |          | 用户发起标记请求                            |
| DataBase.getStaInfo    |          | 获取DataBase中特定类型的数据                |
| DataBase.getMovieInfo  |          | 获取DataBase中movie的信息                   |

(4) 业务逻辑层的动态模型

**图4-7-2 查看统计数据顺序图**

![查看统计数据顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-7-2%E6%9F%A5%E7%9C%8B%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

**图4-7-3 统计电影想看人数顺序图**

![统计电影想看人数顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-7-3%E7%BB%9F%E8%AE%A1%E7%94%B5%E5%BD%B1%E6%83%B3%E7%9C%8B%E4%BA%BA%E6%95%B0%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

**图4-7-4 标记电影为想看顺序图**

![标记电影为想看顺序图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-7-4%E6%A0%87%E8%AE%B0%E7%94%B5%E5%BD%B1%E4%B8%BA%E6%83%B3%E7%9C%8B%E9%A1%BA%E5%BA%8F%E5%9B%BE.jpg)

如下图所示的状态图描述了Mark对象的生存期间的状态序列、引起转移的事件，以及因状态转移而伴随的动作。随着checkMember方法被UI调用，Mark进入检验身份状态；通过mark进入标记状态；最终退出该状态

**图4-7-5 标记电影为想看状态图**

![标记电影为想看状态图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E5%9B%BE/4-7-5%E6%A0%87%E8%AE%B0%E7%94%B5%E5%BD%B1%E4%B8%BA%E6%83%B3%E7%9C%8B%E7%8A%B6%E6%80%81%E5%9B%BE.jpg)

(5) 业务逻辑层的设计原理

利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象

## 5. 依赖视角

下图分别为客户端包图和服务器端包图

![NJUSE影院管理系统的客户端开发包图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E9%80%BB%E8%BE%91%E8%AE%BE%E8%AE%A1%E5%8C%85%E5%9B%BE/%E7%B3%BB%E7%BB%9F%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE.jpg)![NJUSE影院管理系统的服务端开发包图](https://raw.githubusercontent.com/D-Mer/learngit/master/%E5%A4%A7%E4%BD%9C%E4%B8%9A%E5%9B%BE/%E9%80%BB%E8%BE%91%E8%AE%BE%E8%AE%A1%E5%8C%85%E5%9B%BE/%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE.jpg)